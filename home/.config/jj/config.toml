#:schema https://docs.jj-vcs.dev/latest/config-schema.json

[user]
name = "Dillon Mulroy"
email = "dillon.mulroy@gmail.com"

[ui]
editor = "nvim"

[ui.movement]
# Make prev/next default to --edit mode (edit commit in place)
# instead of creating new working copy children
edit = true


[signing]
# Only sign commits authored by you
behavior = "own"
# Use SSH keys for commit signing
backend = "ssh"
key = "~/.ssh/key.pub"

[git]
sign-on-push = true

# Prevent pushing commits that are work-in-progress
# jj git push will refuse to push these commits and warn you
private-commits = "description(glob:'wip:*') | description(glob:'WIP:*') | description(exact:'')"

[template-aliases]
# Show relative timestamps like "2 hours ago" instead of full dates
'format_timestamp(timestamp)' = 'timestamp.ago()'

# Show just username from email (dillon instead of dillon@example.com)
'format_short_signature(signature)' = 'signature.email().local()'

[fsmonitor]
# Use Watchman for faster working copy snapshots in large repos
# Requires: brew install watchman
backend = "watchman"

[aliases]
bm = ["bookmark"]
gf = ["git", "fetch"]
gp = ["git", "push"]

# Advance the closest bookmark to your latest pushable change
# Works with describe workflow: jj new my-feature, work, jj desc -m "feat", jj tug
# closest_pushable(@) finds @ if it has a description, otherwise @-
tug = ["bookmark", "move", "--from", "closest_bookmark(@)", "--to", "closest_pushable(@)"]

# Show your entire connected stack
stack = ["log", "-r", "stack()"]

[revset-aliases]
# Find commits authored by you
'mine()' = 'author(dmmulroy)'

# Your commits that aren't immutable (trunk/tags/remote branches)
# Shows all your mutable work across the repo
'wip()' = 'mine() ~ immutable()'

# Your commits not yet merged into trunk
# Shows your unmerged/unpushed work
'open()' = 'mine() ~ ::trunk()'

# Find the nearest bookmark in ancestry from a revision
# Used by tug alias to find which bookmark to advance
'closest_bookmark(to)' = 'heads(::to & bookmarks())'

# Find the nearest "pushable" commit - non-empty with a description
# Skips empty WIP commits when advancing bookmarks
'closest_pushable(to)' = 'heads(::to & mutable() & ~description(exact:"") & (~empty() | merges()))'

# Show current branch from @ to its leaf commits
'current()' = '@:: & mutable()'

# Show your entire stack - all mutable commits connected to @
# reachable() finds commits reachable in any direction (ancestors + descendants)
# within the mutable() set (excludes immutable trunk/tags)
'stack()' = 'reachable(@, mutable())'

# Work-specific overrides for repos in ~/Code/work
[[--scope]]
--when.repositories = ["~/Code/work"]

[--scope.user]
email = "dillon@cloudflare.com"
